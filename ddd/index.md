# Building a secrets store in Go

## Index

- [Concept](concept.md)
- [Design](design/design.md)
  - [App structure](design/app_structure.md)
  - [Error handling](design/error_handling.md)
  - [Entities](design/entities.md)
    - [User](design/entities.md#user)
    - [Secret](design/entities.md#secret)
    - [Shared](design/entities.md#shared)
  - [Database Design](design/database_design.md)
    - [`users` table](design/database_design.md#users-table)
    - [`secrets` table](design/database_design.md#secrets-table)
    - [`shared` table](design/database_design.md#shared_secrets-table)
  - [Actions and operations](design/actions_and_operations.md)
  - [Security](design/security.md)
  - [Product Format](design/product_format.md)
- [Implementation](implementation/implementation.md)
  - [The `user` package](implementation/user_package.md)
    - [`user.go` - defining entities](implementation/user_package.md#usergo---defining-entities)
    - [`repository.go` - defining the actions](implementation/user_package.md#repositorygo---defining-the-actions)
    - [Users recap](implementation/user_package.md#users-recap)
  - [The `secret` package](implementation/secret_package.md)
    - [`secret.go` - defining entities](implementation/secret_package.md#secretgo---defining-entities)
    - [`repository.go` - defining the actions](implementation/secret_package.md#repositorygo---defining-the-actions)
    - [Secrets recap](implementation/secret_package.md#secrets-recap)
  - [The `shared` package](implementation/shared_package.md)
    - [`shared.go` - defining entities](implementation/shared_package.md#sharedgo---defining-entities)
    - [`repository.go` - defining the actions](implementation/shared_package.md#repositorygo---defining-the-actions)
    - [Shared recap](implementation/shared_package.md#shared-recap)
  - [The `keys` package](implementation/keys_package.md)
    - [`key.go` - defining constants and identifiers](implementation/keys_package.md#keygo---defining-constants-and-identifiers)
    - [`repository.go` - defining the actions](implementation/keys_package.md#repositorygo---defining-the-actions)
    - [Keys recap](implementation/keys_package.md#keys-recap)
  - [Bolt DB implementation](implementation/boltdb.md)
    - [Initializing a Bolt DB instance](implementation/boltdb.md#initializing-a-bolt-db-instance)
    - [Implementing `keysRepository.Get`](implementation/boltdb.md#implementing-keysrepositoryget)
    - [Implementing `keysRepository.Set`](implementation/boltdb.md#implementing-keysrepositoryset)
    - [Implementing `keysRepository.Delete` and `keysRepository.Purge`](implementation/boltdb.md#implementing-keysrepositorydelete-and-keysrepositorypurge)
    - [Defining errors and updating `import`s](implementation/boltdb.md#defining-errors-and-updating-imports)
    - [BoltDB recap](implementation/boltdb.md#boltdb-recap)
  - [SQLite implementation](implementation/sqlite.md)
    - [Defining the initial migration](implementation/sqlite.md#defining-the-initial-migration)
    - [Initializing a SQLite DB instance](implementation/sqlite.md#initializing-a-sqlite-db-instance)
    - [Defining helper functions](implementation/sqlite.md#defining-helper-functions)
      - [SQL Querier types](implementation/sqlite.md#sql-querier-types)
      - [SQL-type converters](implementation/sqlite.md#sql-type-converters)
      - [IsEntityFound functions](implementation/sqlite.md#isentityfound-functions)
    - [Implementing `user.Repository`](implementation/sqlite.md#implementing-userrepository)
      - [Implementing `userRepository.Create`](implementation/sqlite.md#implementing-userrepositorycreate)
      - [Implementing `userRepository.Get`](implementation/sqlite.md#implementing-userrepositoryget)
      - [Implementing `userRepository.List`](implementation/sqlite.md#implementing-userrepositorylist)
      - [Implementing `userRepository.Update`](implementation/sqlite.md#implementing-userrepositoryupdate)
      - [Implementing `userRepository.Delete`](implementation/sqlite.md#implementing-userrepositorydelete)
      - [Defining errors and updating `import`s](implementation/sqlite.md#defining-errors-and-updating-imports)
    - [Implementing `secret.Repository`](implementation/sqlite.md#implementing-secretrepository)
      - [Implementing `secretRepository.Create`](implementation/sqlite.md#implementing-secretrepositorycreate)
      - [Implementing `secretRepository.Get`](implementation/sqlite.md#implementing-secretrepositoryget)
      - [Implementing `secretRepository.List`](implementation/sqlite.md#implementing-secretrepositorylist)
      - [Implementing `secretRepository.Delete`](implementation/sqlite.md#implementing-secretrepositorydelete)
      - [Defining errors and updating `import`s](implementation/sqlite.md#defining-errors-and-updating-imports-1)
    - [Implementing `shared.Repository`](implementation/sqlite.md#implementing-sharedrepository)
      - [Implementing `sharedRepository.Create`](implementation/sqlite.md#implementing-sharedrepositorycreate)
      - [Implementing `sharedRepository.Get`](implementation/sqlite.md#implementing-sharedrepositoryget)
      - [Implementing `sharedRepository.List`](implementation/sqlite.md#implementing-sharedrepositorylist)
      - [Implementing `sharedRepository.ListTarget`](implementation/sqlite.md#implementing-sharedrepositorylisttarget)
      - [Implementing `sharedRepository.Delete`](implementation/sqlite.md#implementing-sharedrepositorydelete)
      - [Defining errors and updating `import`s](implementation/sqlite.md#defining-errors-and-updating-imports-2)
    - [Service preparation](implementation/service_preparation.md)
      - [Cryptography](implementation/cryptography.md)
        - [Key generating methods](implementation/cryptography.md#key-generating-methods)
      - [Authorization](implementation/cryptography.md#authorization)
    - [Service implementation](implementation/service_implementation.md)
      - [Implementing Service Users methods](implementation/service_implementation.md#implementing-service-users-methods)
        - [`service.CreateUser`](implementation/service_implementation.md#servicecreateuser)
        - [`service.GetUser`](implementation/service_implementation.md#servicegetuser)
        - [`service.ListUsers`](implementation/service_implementation.md#servicelistusers)
        - [`service.UpdateUser`](implementation/service_implementation.md#serviceupdateuser)
        - [`service.DeleteUser`](implementation/service_implementation.md#servicedeleteuser)
      - [Implementing Service Secrets methods](implementation/service_implementation.md#implementing-service-secrets-methods)
        - [`service.CreateSecret`](implementation/service_implementation.md#servicecreatesecret)
        - [`service.GetSecret`](implementation/service_implementation.md#servicegetsecret)
        - [`service.ListSecrets`](implementation/service_implementation.md#servicelistsecrets)
        - [`service.DeleteSecret`](implementation/service_implementation.md#servicedeletesecret)
      - [Implementing Service Shares methods](implementation/service_implementation.md#implementing-service-shares-methods)
        - [`service.CreateShare` / `ShareFor` / `ShareUntil`](implementation/service_implementation.md#servicecreateshare--sharefor--shareuntil)
        - [`service.GetShare`](implementation/service_implementation.md#servicegetshare)
        - [`service.ListShares`](implementation/service_implementation.md#servicelistshares)
        - [`service.DeleteShare`](implementation/service_implementation.md#servicedeleteshare)
        - [`service.PurgeShares`](implementation/service_implementation.md#servicepurgeshares)
      - [Implementing Service Sessions methods](implementation/service_implementation.md#implementing-service-sessions-methods)
        - [`service.Login`](implementation/service_implementation.md#servicelogin)
        - [`service.Logout`](implementation/service_implementation.md#servicelogout)
        - [`service.ChangePassword`](implementation/service_implementation.md#servicechangepassword)
        - [`service.Refresh`](implementation/service_implementation.md#servicerefresh)
        - [`service.ParseToken`](implementation/service_implementation.md#serviceparsetoken)
    - [HTTP API implementation ](implementation/http_api_implementation.md)
      - [Peek into `ghttp`](implementation/http_api_implementation.md#peek-into-ghttp)
      - [Designing the endpoints](implementation/http_api_implementation.md#designing-the-endpoints)
      - [HTTP helpers](implementation/http_api_implementation.md#http-helpers)
      - [Defining the server](implementation/http_api_implementation.md#defining-the-server)
        - [`server.usersGet`](implementation/http_api_implementation.md#serverusersget)
        - [`server.usersList`](implementation/http_api_implementation.md#serveruserslist)
        - [`server.usersUpdate`](implementation/http_api_implementation.md#serverusersupdate)
        - [`server.usersDelete`](implementation/http_api_implementation.md#serverusersdelete)
        - [`server.secretsCreate`](implementation/http_api_implementation.md#serversecretscreate)
        - [`server.secretsGet`](implementation/http_api_implementation.md#serversecretsget)
        - [`server.secretsList`](implementation/http_api_implementation.md#serversecretslist)
        - [`server.secretsDelete`](implementation/http_api_implementation.md#serversecretsdelete)
        - [`server.sharesCreate`](implementation/http_api_implementation.md#serversharescreate)
        - [`server.sharesGet`](implementation/http_api_implementation.md#serversharesget)
        - [`server.sharesList`](implementation/http_api_implementation.md#servershareslist)
        - [`server.sharesDelete`](implementation/http_api_implementation.md#serversharesdelete)
        - [`server.login`](implementation/http_api_implementation.md#serverlogin)
        - [`server.logout`](implementation/http_api_implementation.md#serverlogout)
        - [`server.changePassword`](implementation/http_api_implementation.md#serverchangepassword)
        - [`server.refresh`](implementation/http_api_implementation.md#serverrefresh)
      - [Adding auth middleware](implementation/http_api_implementation.md#adding-auth-middleware)
      - [Defining the routes](implementation/http_api_implementation.md#defining-the-routes)
      - [Server interface](implementation/http_api_implementation.md#server-interface)
    - [Setting up factories](implementation/factories.md)
      - [Authorizer](implementation/factories.md#authorizer)
      - [SQLite](implementation/factories.md#sqlite)
      - [Bolt](implementation/factories.md#bolt)
      - [Service](implementation/factories.md#service)
      - [Server](implementation/factories.md#server)
    - [The `cmd` package](implementation/cmd_package.md)
      - [App configuration](implementation/cmd_package.md#app-configuration)
        - [Port option](implementation/cmd_package.md#port-option)
        - [Bolt option](implementation/cmd_package.md#bolt-option)
        - [SQLite option](implementation/cmd_package.md#sqlite-option)
        - [JWT Key option](implementation/cmd_package.md#jwt-key-option)
      - [CLI flags](implementation/cmd_package.md#cli-flags)
      - [OS environment variables](implementation/cmd_package.md#os-environment-variables)
      - [Improving the factory](implementation/cmd_package.md#improving-the-factory)
      - [Server runtime](implementation/cmd_package.md#server-runtime)
  - [Observability and middleware](observability_and_middleware.md)
    - [`keys.Repository` observability](observability_and_middleware.md#keysrepository-observability)
    - [`user.Repository` observability](observability_and_middleware.md#userrepository-observability)
    - [`secret.Repository` observability](observability_and_middleware.md#secretrepository-observability)
    - [`shared.Repository` observability](observability_and_middleware.md#sharedrepository-observability)
    - [`authz.Authorizer` observability](observability_and_middleware.md#authzauthorizer-observability)
    - [`service.Service` observability](observability_and_middleware.md#serviceservice-observability)
    - [Updating factories](observability_and_middleware.md#updating-factories)
    - [HTTP observability](observability_and_middleware.md#http-observability)
  - [Wrapping up](wrapping_up.md)
  - [Final thoughts](final_thoughts.md)